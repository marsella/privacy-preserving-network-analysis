# EMP-toolkit

EMP-toolkit source is available [on github](https://github.com/emp-toolkit).

## Docker setup

Create a Docker image. This will take a few minutes. You only have to do this once.

```
$ docker build -t emp .
```
Spin up a Docker container from the image. 
```
$ docker run -it --rm emp
```

The benchmarking scripts can be run inside the container environment.

## Benchmarking

We implemented both the [Eisenburg and Noe (EN)](https://www.jstor.org/stable/2661572) and [Elliot, Golub, and Jackson (EGJ)](https://www.aeaweb.org/articles?id=10.1257/aer.104.10.3115) algorithms in EMP toolkit.

In our paper, we reported the circuit sizes (not the running times) for both algorithms.
These data were generated by running [EN_circuit_sizes](EN_circuit_sizes.sh) and [EGJ_circuit_sizes.sh](EGJ_circuit_sizes.sh) with a successful installation of the software.

To recreate the raw data used for these charts

Inside the docker, you can run the scripts:

```
$ ~/emp-sh2pc/build/EN_circuit_sizes.sh
```
and 
```
$ ~/emp-sh2pc/build/EGJ_circuit_sizes.sh
```
Which will generate the data behind the circuit-size charts used in Figure 7 of the paper.

## Binaries and scripts

EMP toolkit provides tools for securely computing on *integers*, but our calculations require matrix arithmetic on rational numbers, so to run our tests, we had to write libraries secur fixed point arithmetic, and secure matrix operations.

- [fixedp.h](source/fixedp.h) - Provides an EMP implementation of fixed-precision arithmetic, i.e., addition and multiplication of fixed-point numbers
- [matrix.h](source/matrix.h) - Provides an EMP implementation of matrix operations over fixed point arithmetic, including addition, multiplication, transposition as well as the determinant and [adjugate](https://en.wikipedia.org/wiki/Adjugate_matrix), which are necessary for matrix inversion (requires `fixedp.h`)
- [matrix_tests.cpp](source/matrix_tests.cpp) - Tests whether the addition operator provided by matrix.h functions correctly
- [matmul_tests.cpp](source/matmul_tests.cpp) - Tests whether the multiplication operator provided by matrix.h functions correctly
- [EN.cpp](source/EN.cpp) - This is the main program for generating the clearing algorithm for the EN model (requires `matrix.h`)
- [intclearing.cpp](source/intclearing.cpp) - An alternative version of the EN clearing algorithm using only integer arithmetic 
- [EGJ.cpp](source/EGJ.cpp) - This is the main program for generating the clearing algorithm for the EGJ model (requires `matrix.h`)
- [EN_circuit_sizes.sh](source/EN_circuit_sizes.sh) - Using EN.cpp to generate clearing circuits for successively larger networks and records the number of gates to a file
- [EGJ_circuit_sizes.sh](source/EGJ_circuit_sizes.sh) - Using EGJ.cpp to generate clearing circuits for successively larger networks and records the number of gates to a file
- [geninput.py](geninput.py) - Generates synthetic input data in a format that can be consumed by the EN and EGJ circuits.

## Running examples

The docker environment contains builds of [EN.cpp](source/EN.cpp) as well as [EGJ.cpp](source/EGJ.cpp) in the *semi-honest* model

Inside the docker, you can run the scripts:

```
$ ~/emp-sh2pc/build/EN_circuit_sizes.sh
```
and 
```
$ ~/emp-sh2pc/build/EGJ_circuit_sizes.sh
```
Which will generate the circuit-size charts used in Figure 7 of the paper.


If you would like to securely execute the circuits (in a 2-party environment)

First, generate synthetic data:
```
$ python3 geninput.py -n 2
```

You can open two terminals and run each party separately, or run them in the same command:
```
$ ~/emp-sh2pc/bin/EN 1 12345 32 & ~/emp-sh2pc/bin/EN 2 12345 10
```

The command line arguments are
```
$ ~/emp-sh2pc/bin/EN <Participant number> <Port> <Number of banks>
```

Both participants must use the same Port to communicate and compute a clearing network with the same number of banks

If you would like to execute the circuits in a *multi*-party environment, you will need to install emp-agmpc.

